<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dünya Deprem Atlası - Canlı Takip</title>
    
    <!-- Mobil Uygulama Ayarları -->
    <meta name="theme-color" content="#1f2937">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1087/1087815.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1087/1087815.png">

    <!-- Gerekli Kütüphaneler (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <style>
        body, html, #root { height: 100%; width: 100%; margin: 0; overflow: hidden; background-color: #111827; touch-action: none; }
        
        /* Harita Popup Stilleri */
        .leaflet-popup-content-wrapper { background: rgba(31, 41, 55, 0.95); color: white; border-radius: 8px; border: 1px solid #4b5563; }
        .leaflet-popup-tip { background: rgba(31, 41, 55, 0.95); border: 1px solid #4b5563; }
        .leaflet-popup-content { margin: 12px; font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 13px; line-height: 1.5; }
        .leaflet-container a.leaflet-popup-close-button { color: #9ca3af; }
        
        /* Canlı Deprem Animasyonu */
        @keyframes pulse-ring {
            0% { transform: scale(0.5); opacity: 1; }
            80%, 100% { transform: scale(2.5); opacity: 0; }
        }
        .live-quake-marker { position: relative; pointer-events: none; }
        .live-quake-marker::before {
            content: ''; position: absolute; left: -10px; top: -10px; width: 20px; height: 20px;
            border-radius: 50%; background-color: rgba(45, 212, 191, 0.6);
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        /* Mobil arayüz düzeltmeleri */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- İKON BİLEŞENLERİ (SVG) ---
        const IconBase = ({ children, color = "currentColor", size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Activity = (props) => <IconBase {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></IconBase>;
        const AlertTriangle = (props) => <IconBase {...props}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></IconBase>;
        const GlobeIcon = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></IconBase>;
        const XIcon = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconBase>;
        const Clock = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></IconBase>;
        const MapIcon = (props) => <IconBase {...props}><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></IconBase>;
        const Wifi = (props) => <IconBase {...props}><path d="M5 12.55a11 11 0 0 1 14.08 0"></path><path d="M1.42 9a16 16 0 0 1 21.16 0"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></IconBase>;

        // --- VERİ SETLERİ ---
        const faultLines = [
            { id: 'kaf', name: 'Kuzey Anadolu Fay Hattı', type: 'Doğrultu Atımlı', color: '#ef4444', region: 'Türkiye', coordinates: [[39.3, 41.0], [39.5, 40.0], [39.8, 39.0], [40.0, 38.0], [40.2, 37.0], [40.5, 36.0], [40.7, 35.0], [40.8, 34.0], [40.9, 33.0], [40.8, 32.0], [40.7, 31.0], [40.7, 30.0], [40.8, 29.0], [40.7, 28.0], [40.5, 27.0], [40.3, 26.0]], description: 'Dünyanın en aktif sağ yanal atımlı faylarından biri.' },
            { id: 'daf', name: 'Doğu Anadolu Fay Hattı', type: 'Sol Yanal Atımlı', color: '#f97316', region: 'Türkiye', coordinates: [[36.2, 36.1], [36.5, 36.3], [37.0, 36.8], [37.5, 37.2], [38.0, 38.0], [38.4, 39.2], [38.8, 40.0], [39.3, 41.0]], description: 'Arap ve Anadolu levhaları sınırı.' },
            { id: 'baf', name: 'Batı Anadolu Fayları', type: 'Normal Faylar', color: '#eab308', region: 'Türkiye', coordinates: [[[38.5, 27.0], [38.5, 29.0]], [[37.8, 27.2], [37.8, 29.1]], [[39.0, 26.5], [39.0, 28.0]], [[36.8, 27.5], [37.0, 28.5]]], description: 'Ege açılma rejimi fayları.' },
            { id: 'san_andreas', name: 'San Andreas Fayı', type: 'Doğrultu Atımlı', color: '#8b5cf6', region: 'ABD', coordinates: [[40.0, -124.0], [38.0, -123.0], [36.0, -121.0], [34.0, -118.0], [33.0, -116.0], [31.0, -114.0]], description: 'Pasifik ve Kuzey Amerika levhaları sınırı.' },
            { id: 'cascadia', name: 'Cascadia Yitim Zonu', type: 'Yitim Zonu', color: '#d946ef', region: 'Kanada/ABD', coordinates: [[50.0, -128.0], [48.0, -126.0], [45.0, -125.0], [40.0, -124.0]], description: 'Mega deprem üretme potansiyeline sahip dalma-batma zonu.' },
            { id: 'aleutian', name: 'Aleut Çukuru', type: 'Yitim Zonu', color: '#ef4444', region: 'Alaska', coordinates: [[55.0, -160.0], [53.0, -170.0], [52.0, -180.0], [52.0, 170.0], [54.0, 160.0]], description: 'Pasifik levhasının kuzey sınırı.' },
            { id: 'chile_peru', name: 'Peru-Şili Çukuru', type: 'Yitim Zonu', color: '#ef4444', region: 'Güney Amerika', coordinates: [[0.0, -80.0], [-10.0, -78.0], [-20.0, -72.0], [-33.0, -73.0], [-40.0, -75.0], [-55.0, -70.0]], description: 'Tarihin en büyük depremlerinin kaynağı.' },
            { id: 'japan_trench', name: 'Japonya Çukuru', type: 'Yitim Zonu', color: '#ef4444', region: 'Japonya', coordinates: [[42.0, 144.0], [40.0, 144.0], [38.0, 143.5], [36.0, 142.0], [34.0, 140.0]], description: 'Japonya doğusundaki derin okyanus hendeği.' },
            { id: 'kuril_kamchatka', name: 'Kuril-Kamçatka', type: 'Yitim Zonu', color: '#ef4444', region: 'Rusya', coordinates: [[56.0, 162.0], [54.0, 160.0], [52.0, 158.5], [50.0, 157.0], [48.0, 155.0]], description: 'Pasifik levhasının Avrasya altına daldığı bölge.' },
            { id: 'philippines', name: 'Filipinler Levhası', type: 'Karmaşık', color: '#ef4444', region: 'Asya', coordinates: [[25.0, 122.0], [20.0, 121.0], [15.0, 120.0], [10.0, 126.0], [5.0, 128.0]], description: 'Yoğun sismik aktivite bölgesi.' },
            { id: 'indonesia', name: 'Sunda Yayı', type: 'Yitim Zonu', color: '#ef4444', region: 'Endonezya', coordinates: [[10.0, 95.0], [5.0, 95.0], [0.0, 97.0], [-5.0, 102.0], [-8.0, 110.0], [-8.0, 120.0]], description: 'Hint Okyanusu tsunami kuşağı.' },
            { id: 'himalaya', name: 'Himalaya Cephesi', type: 'Çarpışma Zonu', color: '#ef4444', region: 'Asya', coordinates: [[34.0, 73.0], [32.0, 76.0], [29.0, 80.0], [27.0, 88.0], [27.0, 95.0]], description: 'Kıta-kıta çarpışma hattı.' },
            { id: 'alpine_nz', name: 'Alpine Fayı', type: 'Doğrultu Atımlı', color: '#10b981', region: 'Yeni Zelanda', coordinates: [[-40.0, 174.0], [-42.0, 172.0], [-44.0, 168.0], [-46.0, 166.0]], description: 'Güney Adası ana fayı.' },
            { id: 'mid_atlantic', name: 'Atlantik Ortası Sırtı', type: 'Ayrılma', color: '#3b82f6', region: 'Atlantik', coordinates: [[85.0, 0.0], [75.0, 5.0], [60.0, -30.0], [45.0, -28.0], [30.0, -40.0], [15.0, -45.0], [0.0, -25.0], [-15.0, -15.0], [-30.0, -13.0], [-55.0, -5.0]], description: 'Okyanus tabanı yayılma merkezi.' },
            { id: 'east_african', name: 'Doğu Afrika Rifti', type: 'Kıtasal Ayrılma', color: '#eab308', region: 'Afrika', coordinates: [[15.0, 40.0], [10.0, 40.0], [5.0, 35.0], [0.0, 30.0], [-10.0, 34.0], [-20.0, 35.0]], description: 'Afrika kıtasının ayrılma hattı.' }
        ];

        const seismicGaps = [
            { id: 'gap_marmara', name: 'Marmara Segmenti', riskLevel: 'Kritik', probability: '%60+ (30 Yıl)', region: 'Türkiye', coordinates: [[40.75, 29.5], [40.8, 29.0], [40.85, 28.5], [40.85, 28.0], [40.8, 27.5]], description: 'İstanbul açıklarında beklenen kırılma.' },
            { id: 'gap_nankai', name: 'Nankai Çukuru', riskLevel: 'Çok Yüksek', probability: '%70-80', region: 'Japonya', coordinates: [[34.0, 138.0], [33.0, 136.0], [32.0, 134.0], [31.5, 132.0]], description: 'Japonya güneyi için mega deprem riski.' },
            { id: 'gap_cascadia', name: 'Cascadia', riskLevel: 'Kritik', probability: '%30 (M8+)', region: 'ABD', coordinates: [[50.0, -128.0], [48.0, -126.0], [46.0, -125.0], [44.0, -125.0], [40.5, -124.5]], description: 'Kuzey Amerika batı kıyısı riski.' }
        ];

        const historicalEarthquakes = [
            // Güncel
            { id: 201, name: 'Kamçatka', date: '29 Tem 2025', magnitude: 8.8, coordinates: [52.50, 160.24], location: 'Rusya', fault: 'Kuril-Kamçatka', details: '1952\'den sonraki en büyük olay.' },
            { id: 202, name: 'Noto Yarımadası', date: '1 Oca 2024', magnitude: 7.5, coordinates: [37.50, 137.24], location: 'Japonya', fault: 'Japon Denizi', details: 'Yılbaşı günü gerçekleşen yıkıcı deprem.' },
            { id: 203, name: 'Hualien', date: '3 Nis 2024', magnitude: 7.4, coordinates: [23.82, 121.56], location: 'Tayvan', fault: 'Boyuna Vadi', details: 'Son 25 yılın en büyüğü.' },
            // Türkiye
            { id: 1, name: 'Erzincan', date: '1939', magnitude: 7.9, coordinates: [39.77, 39.53], location: 'Erzincan, TR', fault: 'KAF', details: '33.000 can kaybı, en büyük deprem.' },
            { id: 2, name: 'Gölcük', date: '1999', magnitude: 7.4, coordinates: [40.70, 29.91], location: 'Kocaeli, TR', fault: 'KAF', details: 'Marmara bölgesinde büyük yıkım.' },
            { id: 3, name: 'Van', date: '2011', magnitude: 7.2, coordinates: [38.63, 43.48], location: 'Van, TR', fault: 'Bindirme Fayı', details: 'Erciş ilçesinde ağır hasar.' },
            { id: 4, name: 'Kahramanmaraş', date: '6 Şub 2023', magnitude: 7.7, coordinates: [37.28, 37.03], location: 'Pazarcık, TR', fault: 'DAF', details: 'Asrın felaketi, 11 il etkilendi.' },
            { id: 5, name: 'Elbistan', date: '6 Şub 2023', magnitude: 7.6, coordinates: [38.08, 37.17], location: 'Elbistan, TR', fault: 'Çardak Fayı', details: 'İkinci büyük şok.' },
            { id: 6, name: 'Çaldıran', date: '1976', magnitude: 7.5, coordinates: [39.10, 44.00], location: 'Van, TR', fault: 'Çaldıran Fayı', details: 'Kış şartlarında büyük can kaybı.' },
            { id: 7, name: 'Gediz', date: '1970', magnitude: 7.2, coordinates: [39.20, 29.50], location: 'Kütahya, TR', fault: 'Graben Sistemi', details: 'Batı Anadolu\'nun yıkıcı depremi.' },
            { id: 8, name: 'Ladik', date: '1943', magnitude: 7.2, coordinates: [41.05, 33.72], location: 'Kastamonu, TR', fault: 'KAF', details: 'KAF serisinin bir parçası.' },
            { id: 9, name: 'Gerede', date: '1944', magnitude: 7.2, coordinates: [40.80, 32.20], location: 'Bolu, TR', fault: 'KAF', details: 'Bolu ve çevresinde yıkım.' },
            { id: 10, name: 'Yenice-Gönen', date: '1953', magnitude: 7.2, coordinates: [40.02, 27.53], location: 'Çanakkale, TR', fault: 'KAF Güney', details: 'Güney Marmara fayı.' },
            { id: 11, name: 'Mürefte', date: '1912', magnitude: 7.3, coordinates: [40.70, 27.20], location: 'Tekirdağ, TR', fault: 'Ganos Fayı', details: 'Trakya\'da büyük hasar.' },
            // Dünya
            { id: 101, name: 'Valdivia', date: '1960', magnitude: 9.5, coordinates: [-39.8, -73.2], location: 'Şili', fault: 'Peru-Şili', details: 'Tarihin en büyük depremi.' },
            { id: 102, name: 'Alaska', date: '1964', magnitude: 9.2, coordinates: [61.0, -147.7], location: 'Alaska, ABD', fault: 'Aleut', details: 'Kuzey Amerika\'nın en büyüğü.' },
            { id: 103, name: 'Sumatra', date: '2004', magnitude: 9.1, coordinates: [3.3, 95.8], location: 'Endonezya', fault: 'Sunda', details: 'Devasa tsunamiye yol açtı.' },
            { id: 104, name: 'Tohoku', date: '2011', magnitude: 9.1, coordinates: [38.3, 142.4], location: 'Japonya', fault: 'Japonya Çukuru', details: 'Fukuşima felaketini tetikledi.' },
            { id: 105, name: 'Kamçatka', date: '1952', magnitude: 9.0, coordinates: [52.7, 159.5], location: 'Rusya', fault: 'Kuril-Kamçatka', details: 'Büyük tsunami üretti.' },
            { id: 106, name: 'Maule', date: '2010', magnitude: 8.8, coordinates: [-35.9, -72.7], location: 'Şili', fault: 'Peru-Şili', details: 'Dünya eksenini kaydırdı.' },
            { id: 107, name: 'Ekvador', date: '1906', magnitude: 8.8, coordinates: [1.0, -81.5], location: 'Ekvador', fault: 'Nazca', details: 'Tarihsel büyük deprem.' },
            { id: 108, name: 'Mexico City', date: '1985', magnitude: 8.0, coordinates: [18.4, -102.4], location: 'Meksika', fault: 'Cocos', details: 'Başkenti yıkan deprem.' },
            { id: 109, name: 'Sichuan', date: '2008', magnitude: 7.9, coordinates: [31.0, 103.4], location: 'Çin', fault: 'Longmenshan', details: 'Büyük can kaybı.' },
            { id: 110, name: 'Nepal', date: '2015', magnitude: 7.8, coordinates: [28.2, 84.7], location: 'Nepal', fault: 'Himalaya', details: 'Everest\'te çığ düşürdü.' },
            { id: 111, name: 'Tangshan', date: '1976', magnitude: 7.6, coordinates: [39.6, 118.2], location: 'Çin', fault: 'Bilinmiyor', details: '20. yy en ölümcül depremi.' },
            { id: 112, name: 'Haiti', date: '2010', magnitude: 7.0, coordinates: [18.4, -72.5], location: 'Haiti', fault: 'Enriquillo', details: 'Başkenti yok etti.' }
        ];

        // --- ÜLKE LİSTESİ ---
        const countryList = [
            { name: "Tüm Dünya", code: "All" },
            { name: "Türkiye", code: "Turkey" },
            { name: "Japonya", code: "Japan" },
            { name: "Endonezya", code: "Indonesia" },
            { name: "Şili", code: "Chile" },
            { name: "ABD (Amerika)", code: "USA" },
            { name: "Meksika", code: "Mexico" },
            { name: "Çin", code: "China" },
            { name: "Yunanistan", code: "Greece" },
            { name: "İtalya", code: "Italy" },
            { name: "Rusya", code: "Russia" },
            { name: "Yeni Zelanda", code: "New Zealand" }
        ];

        function TurkiyeDepremHaritasi() {
            const [selectedFeature, setSelectedFeature] = React.useState(null);
            const [activeLayers, setActiveLayers] = React.useState({ faults: true, quakes: true, gaps: false, liveQuakes: false });
            const [sidebarOpen, setSidebarOpen] = React.useState(false);
            const [liveEarthquakeData, setLiveEarthquakeData] = React.useState([]);
            const [loadingLive, setLoadingLive] = React.useState(false);
            const [selectedCountry, setSelectedCountry] = React.useState("All");
            
            const mapContainerRef = React.useRef(null);
            const mapInstanceRef = React.useRef(null);
            const layersRef = React.useRef({ faults: [], quakes: [], gaps: [], liveQuakes: [] });

            const fetchLiveEarthquakes = async () => {
                if (liveEarthquakeData.length > 0 && selectedCountry === "All") return;
                setLoadingLive(true);
                const now = new Date();
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                const startTime = yesterday.toISOString();
                const url = `https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=${startTime}&minmagnitude=4&maxmagnitude=7`;

                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    setLiveEarthquakeData(data.features);
                } catch (error) {
                    alert("Veri çekilemedi. İnternet bağlantısını kontrol edin.");
                } finally {
                    setLoadingLive(false);
                }
            };

            const initMap = () => {
                if (!window.L || mapInstanceRef.current) return;
                const map = L.map(mapContainerRef.current, { zoomControl: false }).setView([25.0, 0.0], 2);
                L.control.zoom({ position: 'bottomright' }).addTo(map);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; CARTO & USGS', subdomains: 'abcd', maxZoom: 19, minZoom: 2, noWrap: true }).addTo(map);
                mapInstanceRef.current = map;
                updateLayers();
            };

            React.useEffect(() => { initMap(); }, []);

            const updateLayers = () => {
                const map = mapInstanceRef.current;
                if (!map || !window.L) return;

                Object.keys(layersRef.current).forEach(key => {
                    layersRef.current[key].forEach(layer => map.removeLayer(layer));
                    layersRef.current[key] = [];
                });

                if (activeLayers.faults) {
                    faultLines.forEach(fault => {
                        const options = { color: fault.color, weight: 2, opacity: 0.7 };
                        const addPoly = (coords) => {
                            const polyline = L.polyline(coords, options).addTo(map);
                            polyline.on('click', () => { setSelectedFeature({...fault, dataType: 'fault'}); setSidebarOpen(true); });
                            layersRef.current.faults.push(polyline);
                        };
                        Array.isArray(fault.coordinates[0][0]) ? fault.coordinates.forEach(addPoly) : addPoly(fault.coordinates);
                    });
                }

                if (activeLayers.gaps) {
                    seismicGaps.forEach(gap => {
                        const glow = L.polyline(gap.coordinates, { color: '#d946ef', weight: 10, opacity: 0.3 }).addTo(map);
                        const line = L.polyline(gap.coordinates, { color: '#d946ef', weight: 4, dashArray: '10,10' }).addTo(map);
                        line.on('click', () => { setSelectedFeature({...gap, dataType: 'gap'}); setSidebarOpen(true); });
                        layersRef.current.gaps.push(glow, line);
                    });
                }

                if (activeLayers.quakes) {
                    historicalEarthquakes.forEach(quake => {
                        let color;
                        if (quake.magnitude >= 9.0) color = '#be123c';
                        else if (quake.magnitude >= 7.0) color = '#ef4444';
                        else color = '#f97316';
                        const marker = L.circleMarker(quake.coordinates, { color: color, fillColor: color, fillOpacity: 0.8, radius: quake.magnitude * 1.5 }).addTo(map);
                        marker.on('click', () => { setSelectedFeature({...quake, dataType: 'quake'}); setSidebarOpen(true); });
                        layersRef.current.quakes.push(marker);
                    });
                }

                if (activeLayers.liveQuakes && liveEarthquakeData.length > 0) {
                    const filteredData = liveEarthquakeData.filter(feature => {
                        if (selectedCountry === "All") return true;
                        const place = feature.properties.place || "";
                        if (selectedCountry === "USA") return ["USA", "United States", "California", "Alaska", "Hawaii", "Nevada"].some(t => place.includes(t));
                        return place.includes(selectedCountry);
                    });

                    const markers = [];
                    filteredData.forEach(feature => {
                        const mag = feature.properties.mag;
                        const coords = [feature.geometry.coordinates[1], feature.geometry.coordinates[0]];
                        const quakeData = {
                            id: feature.id, name: feature.properties.place, magnitude: mag.toFixed(1),
                            date: new Date(feature.properties.time).toLocaleString('tr-TR'),
                            coordinates: coords, location: feature.properties.place, fault: 'Otomatik',
                            details: `Derinlik: ${feature.geometry.coordinates[2]} km. USGS Canlı Veri.`, dataType: 'live'
                        };
                        const marker = L.circleMarker(coords, { color: '#2dd4bf', fillColor: '#2dd4bf', fillOpacity: 0.6, radius: mag * 1.8, className: 'live-quake-marker' }).addTo(map);
                        marker.on('click', () => { setSelectedFeature(quakeData); setSidebarOpen(true); });
                        layersRef.current.liveQuakes.push(marker);
                        markers.push(marker);
                    });

                    if (selectedCountry !== "All" && markers.length > 0) {
                        const group = L.featureGroup(markers);
                        map.fitBounds(group.getBounds(), { padding: [50, 50], maxZoom: 6 });
                    }
                }
            };

            React.useEffect(() => { updateLayers(); }, [activeLayers, liveEarthquakeData, selectedCountry]);

            const toggleLayer = (l) => {
                if (l === 'liveQuakes' && !activeLayers.liveQuakes) fetchLiveEarthquakes();
                setActiveLayers(p => ({...p, [l]: !p[l]}));
            };

            const handleCountryChange = (e) => {
                const country = e.target.value;
                setSelectedCountry(country);
                if (!activeLayers.liveQuakes) {
                    setActiveLayers(p => ({...p, liveQuakes: true}));
                    fetchLiveEarthquakes();
                }
            };

            // Safe Country Name Display Logic
            const getCountryName = () => {
                const found = countryList.find(c => c.code === selectedCountry);
                return found ? found.name : '';
            };

            return (
                <div className="flex flex-col h-screen w-full bg-gray-900 text-white font-sans overflow-hidden relative">
                    <header className="bg-gray-800 p-3 shadow-lg z-20 flex flex-wrap gap-2 justify-between items-center border-b border-gray-700 safe-area-top">
                        <div className="flex items-center gap-2">
                            <GlobeIcon className="text-blue-500" size={20} />
                            <div className="hidden sm:block"><h1 className="text-base sm:text-lg font-bold leading-tight">Dünya Deprem Atlası</h1></div>
                        </div>
                        <div className="flex gap-2 overflow-x-auto pb-1 sm:pb-0 scrollbar-hide items-center">
                            <div className="relative flex items-center">
                                <select value={selectedCountry} onChange={handleCountryChange} className="bg-gray-700 text-white text-xs rounded border border-gray-600 px-2 py-1 mr-2 outline-none focus:border-blue-500">
                                    {countryList.map(c => <option key={c.code} value={c.code}>{c.name}</option>)}
                                </select>
                            </div>
                            <button onClick={() => toggleLayer('faults')} className={`px-2 py-1 rounded text-xs flex items-center gap-1 border ${activeLayers.faults ? 'bg-blue-900/60 border-blue-500 text-blue-100' : 'bg-gray-700 border-gray-600 text-gray-400'}`}><Activity size={14} /> Faylar</button>
                            <button onClick={() => toggleLayer('quakes')} className={`px-2 py-1 rounded text-xs flex items-center gap-1 border ${activeLayers.quakes ? 'bg-red-900/60 border-red-500 text-red-100' : 'bg-gray-700 border-gray-600 text-gray-400'}`}><AlertTriangle size={14} /> Büyük D.</button>
                            <button onClick={() => toggleLayer('liveQuakes')} className={`px-2 py-1 rounded text-xs flex items-center gap-1 border whitespace-nowrap ${activeLayers.liveQuakes ? 'bg-teal-900/60 border-teal-500 text-teal-100 animate-pulse' : 'bg-gray-700 border-gray-600 text-gray-400'}`}><Wifi size={14} /> {loadingLive ? '...' : 'Canlı'}</button>
                        </div>
                    </header>

                    <div className="flex-1 relative flex">
                        <div className="flex-1 bg-gray-900 z-0">
                            <div ref={mapContainerRef} className="h-full w-full" style={{zIndex: 0}}></div>
                            <div className="absolute bottom-6 left-4 bg-gray-800/80 backdrop-blur p-2 rounded border border-gray-600 text-[10px] sm:text-xs z-[400] shadow-xl pointer-events-none">
                                <div className="flex items-center gap-2 mb-1"><span className="w-3 h-1 bg-red-500"></span> Yitim Zonu / Aktif</div>
                                <div className="flex items-center gap-2 mb-1"><span className="w-3 h-3 rounded-full bg-red-600"></span> 7.0+ Büyük Deprem</div>
                                <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-teal-400 animate-pulse"></span> Canlı (4.0+)</div>
                                {selectedCountry !== "All" && (
                                    <div className="mt-1 pt-1 border-t border-gray-600 text-teal-300 font-bold">
                                        Filtre: {getCountryName()}
                                        {activeLayers.liveQuakes && liveEarthquakeData.length > 0 && liveEarthquakeData.filter(f => (f.properties.place || "").includes(selectedCountry)).length === 0 && (
                                            <span className="block text-gray-400 font-normal text-[9px]"> (Son 24 saatte kayıt yok)</span>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className={`absolute top-0 right-0 h-full w-full sm:w-80 bg-gray-900/95 backdrop-blur border-l border-gray-700 shadow-2xl transform transition-transform duration-300 z-[500] overflow-y-auto ${sidebarOpen ? 'translate-x-0' : 'translate-x-full'}`}>
                            {selectedFeature && (
                                <div className="p-5 pb-20">
                                    <button onClick={() => setSidebarOpen(false)} className="absolute top-3 right-3 text-gray-400 hover:text-white"><XIcon size={20}/></button>
                                    <div className="mb-4">
                                        <span className={`text-xs font-bold px-2 py-0.5 rounded border uppercase tracking-wider ${selectedFeature.dataType === 'live' ? 'text-teal-300 border-teal-500 bg-teal-900/30' : selectedFeature.dataType === 'gap' ? 'text-purple-300 border-purple-500 bg-purple-900/30' : selectedFeature.dataType === 'quake' ? 'text-red-300 border-red-500 bg-red-900/30' : 'text-blue-300 border-blue-500 bg-blue-900/30'}`}>
                                            {selectedFeature.dataType === 'live' ? 'CANLI SİSMİK VERİ' : selectedFeature.dataType === 'gap' ? 'Sismik Boşluk' : selectedFeature.dataType === 'quake' ? 'Tarihsel Deprem' : 'Fay Hattı'}
                                        </span>
                                    </div>
                                    <h2 className="text-xl font-bold mb-2">{selectedFeature.name}</h2>
                                    {(selectedFeature.dataType === 'quake' || selectedFeature.dataType === 'live') ? (
                                        <div className="space-y-4">
                                            <div className="bg-gray-800 p-3 rounded border border-gray-700">
                                                <div className="flex justify-between mb-2 border-b border-gray-700 pb-2"><span className="text-gray-400 text-sm">Büyüklük</span><span className={`${selectedFeature.dataType === 'live' ? 'text-teal-400' : 'text-red-400'} font-bold text-lg`}>M{selectedFeature.magnitude}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-400 text-sm">Tarih</span><span>{selectedFeature.date}</span></div>
                                                <div className="mt-2 text-sm text-gray-300 flex items-start gap-2"><MapIcon size={14} className="mt-1 flex-shrink-0" />{selectedFeature.location}</div>
                                            </div>
                                            {selectedFeature.fault && (<div className="bg-blue-900/20 border border-blue-800 p-3 rounded"><div className="text-xs text-blue-300 uppercase font-bold mb-1 flex items-center gap-1"><Activity size={12} /> İlgili Fay</div><div className="text-sm font-semibold text-white">{selectedFeature.fault}</div></div>)}
                                            {selectedFeature.details && (<div><div className="text-xs text-gray-400 uppercase font-bold mb-2 flex items-center gap-1"><FileText size={12} /> Detaylar</div><p className="text-sm text-gray-300 leading-relaxed border-l-2 border-gray-600 pl-3 bg-gray-800/40 p-2 rounded-r">{selectedFeature.details}</p></div>)}
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            <div className="flex gap-2 flex-wrap"><span className="px-2 py-1 bg-gray-800 rounded text-xs text-gray-300 border border-gray-700">{selectedFeature.region}</span>{selectedFeature.type && <span className="px-2 py-1 bg-gray-800 rounded text-xs text-gray-300 border border-gray-700">{selectedFeature.type}</span>}</div>
                                            {selectedFeature.riskLevel && (<div className="bg-purple-900/20 border border-purple-500/50 p-3 rounded"><div className="text-xs text-purple-300 uppercase font-bold mb-1">Risk Seviyesi</div><div className="text-lg font-bold">{selectedFeature.riskLevel}</div><div className="text-sm text-gray-300 mt-1">Olasılık: {selectedFeature.probability}</div></div>)}
                                            <div><h3 className="text-sm font-bold text-gray-400 uppercase mb-1">Açıklama</h3><p className="text-sm text-gray-200 leading-relaxed">{selectedFeature.description}</p></div>
                                            {(selectedFeature.history || selectedFeature.status) && (<div><h3 className="text-sm font-bold text-gray-400 uppercase mb-1">{selectedFeature.dataType === 'gap' ? 'Durum' : 'Tarihçe'}</h3><p className="text-sm text-gray-300 leading-relaxed border-l-2 border-gray-600 pl-3">{selectedFeature.history || selectedFeature.status}</p></div>)}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TurkiyeDepremHaritasi />);
    </script>
</body>
</html>